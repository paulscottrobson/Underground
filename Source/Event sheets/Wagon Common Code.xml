<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>Wagon Common Code</name>
    <events>
        <event-group description="" sid="5537061534551105" title="Wagon General Code and Events" />
        <event-group description="Called every tick to update the game status" sid="9272042552955547" title="Wagon Tick Processing">
            <sub-events>
                <event-block sid="1317636913131503">
                    <conditions>
                        <condition id="-14" name="Compare variable" sid="5736166032316579" type="System">
                            <param id="0" name="Variable">wagonsOperating</param>
                            <param id="1" name="Comparison">1</param>
                            <param id="2" name="Value">0</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <variable constant="0" name="state" sid="9123471933894152" static="0" type="number">0</variable>
                        <event-block sid="3750665577691156">
                            <conditions>
                                <condition id="-11" name="For Each" sid="7669231499650191" type="System">
                                    <param id="0" name="Object">Wagon</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="7508244186005805" type="System">
                                    <param id="0" name="Variable">state</param>
                                    <param id="1" name="Value">Wagon.state</param>
                                </action>
                            </actions>
                            <sub-events>
                                <event-group description="Outbound and Return state use the same code, with a different route list and outcome." sid="8884698332367461" title="Outbound and Return states" />
                                <event-block any="1" sid="2695763288122181">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="548934620572962" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_OUTBOUND</param>
                                        </condition>
                                        <condition id="-14" name="Compare variable" sid="5108997541526579" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_RETURN</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>Have we reached the target ?</comment>
                                        <variable constant="0" name="c" sid="7373451414048555" static="0" type="text"></variable>
                                        <variable constant="0" name="velocity" sid="1573940601064929" static="0" type="number">0</variable>
                                        <event-block sid="5542436665568051">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="5095067621288863" type="Wagon">
                                                    <param id="0" name="Instance variable">xPos</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">Wagon.xTarget</param>
                                                </condition>
                                                <condition id="-7" name="Compare instance variable" sid="3622763566763317" type="Wagon">
                                                    <param id="0" name="Instance variable">yPos</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">Wagon.yTarget</param>
                                                </condition>
                                            </conditions>
                                            <actions />
                                            <sub-events>
                                                <comment>Have we reached the target</comment>
                                                <event-block sid="7466048977390949">
                                                    <conditions>
                                                        <condition id="-7" name="Compare instance variable" sid="5379354763495723" type="Wagon">
                                                            <param id="0" name="Instance variable">routeList</param>
                                                            <param id="1" name="Comparison">0</param>
                                                            <param id="2" name="Value">&quot;&quot;</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions />
                                                    <sub-events>
                                                        <comment>Have we completed OUTBOUND state. If so, switch to EXAMINE state</comment>
                                                        <event-block sid="1618587026225343">
                                                            <conditions>
                                                                <condition id="-14" name="Compare variable" sid="7235849845136129" type="System">
                                                                    <param id="0" name="Variable">state</param>
                                                                    <param id="1" name="Comparison">0</param>
                                                                    <param id="2" name="Value">WST_OUTBOUND</param>
                                                                </condition>
                                                            </conditions>
                                                            <actions>
                                                                <action id="-10" name="Set value" sid="1663028022963874" type="Wagon">
                                                                    <param id="0" name="Instance variable">state</param>
                                                                    <param id="1" name="Value">WST_EXAMINE</param>
                                                                </action>
                                                            </actions>
                                                        </event-block>
                                                        <event-block sid="8129741400853391">
                                                            <conditions>
                                                                <condition id="-14" name="Compare variable" sid="195607379758991" type="System">
                                                                    <param id="0" name="Variable">state</param>
                                                                    <param id="1" name="Comparison">0</param>
                                                                    <param id="2" name="Value">WST_RETURN</param>
                                                                </condition>
                                                            </conditions>
                                                            <actions>
                                                                <action id="-10" name="Set value" sid="2964307959086606" type="Wagon">
                                                                    <param id="0" name="Instance variable">state</param>
                                                                    <param id="1" name="Value">WST_QUEUED</param>
                                                                </action>
                                                                <action id="-15" name="Set visible" sid="2142894310219494" type="Wagon">
                                                                    <param id="0" name="Visibility">0</param>
                                                                </action>
                                                                <action id="0" name="Call function" sid="8591778099980133" type="Function">
                                                                    <param id="0" name="Name">&quot;WagonHasReturned&quot;</param>
                                                                    <param id="1" name="Parameter {n}">Wagon.UID</param>
                                                                </action>
                                                            </actions>
                                                            <sub-events>
                                                                <event-block sid="8659606666837381">
                                                                    <conditions>
                                                                        <condition id="-14" name="Pick by unique ID" sid="8818624625835929" type="WagonMarker">
                                                                            <param id="0" name="Unique ID">Wagon.markerUID</param>
                                                                        </condition>
                                                                    </conditions>
                                                                    <actions>
                                                                        <action id="-15" name="Set visible" sid="2753704544548903" type="WagonMarker">
                                                                            <param id="0" name="Visibility">0</param>
                                                                        </action>
                                                                    </actions>
                                                                </event-block>
                                                            </sub-events>
                                                        </event-block>
                                                    </sub-events>
                                                </event-block>
                                                <comment>No, there is more in the route list. Get the next entry from the route list and set it as the new target</comment>
                                                <event-block sid="9457500938163426">
                                                    <conditions>
                                                        <condition id="-22" name="Else" sid="1645309253106558" type="System" />
                                                    </conditions>
                                                    <actions>
                                                        <action id="-9" name="Set value" sid="8938633511885288" type="System">
                                                            <param id="0" name="Variable">c</param>
                                                            <param id="1" name="Value">tokenat(Wagon.routeList,0,&quot;|&quot;)</param>
                                                        </action>
                                                        <action id="-10" name="Set value" sid="1528442414770751" type="Wagon">
                                                            <param id="0" name="Instance variable">routeList</param>
                                                            <param id="1" name="Value">mid(Wagon.routeList,len(c)+1,999)</param>
                                                        </action>
                                                        <action id="-10" name="Set value" sid="7452478082345736" type="Wagon">
                                                            <param id="0" name="Instance variable">xTarget</param>
                                                            <param id="1" name="Value">int(tokenat(c,0,&quot;,&quot;))</param>
                                                        </action>
                                                        <action id="-10" name="Set value" sid="9973588629300396" type="Wagon">
                                                            <param id="0" name="Instance variable">yTarget</param>
                                                            <param id="1" name="Value">int(tokenat(c,1,&quot;,&quot;))</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                        <comment>Not reached the target</comment>
                                        <event-block sid="7440247692727476">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="9351424389738631" type="System" />
                                            </conditions>
                                            <actions>
                                                <action id="-9" name="Set value" sid="6308026573329448" type="System">
                                                    <param id="0" name="Variable">velocity</param>
                                                    <param id="1" name="Value">Wagon.velocity</param>
                                                </action>
                                            </actions>
                                            <sub-events>
                                                <comment>In shaft, move at a fixed speed irrespective of anything</comment>
                                                <event-block sid="3185935751699824">
                                                    <conditions>
                                                        <condition id="-8" name="Compare two values" sid="1365071521035258" type="System">
                                                            <param id="0" name="First value">Wagon.yPos</param>
                                                            <param id="1" name="Comparison">1</param>
                                                            <param id="2" name="Second value">Wagon.yTarget</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="-9" name="Set value" sid="7002201275274372" type="System">
                                                            <param id="0" name="Variable">velocity</param>
                                                            <param id="1" name="Value">SHAFTVELOCITY</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                                <comment>Moving horizontally so check overlapping and rails</comment>
                                                <event-block sid="5535612285901028">
                                                    <conditions>
                                                        <condition id="-22" name="Else" sid="7106202086974015" type="System" />
                                                    </conditions>
                                                    <actions />
                                                    <sub-events>
                                                        <event-block sid="3383740566078346">
                                                            <conditions>
                                                                <condition id="1" name="Is overlapping another object" sid="5754195975165636" type="Wagon">
                                                                    <param id="0" name="Object">WagonFamily</param>
                                                                </condition>
                                                            </conditions>
                                                            <actions>
                                                                <action id="-9" name="Set value" sid="3658126437953375" type="System">
                                                                    <param id="0" name="Variable">velocity</param>
                                                                    <param id="1" name="Value">velocity*PASSINGPENALTY</param>
                                                                </action>
                                                            </actions>
                                                        </event-block>
                                                        <event-block sid="5829335697376847">
                                                            <conditions>
                                                                <condition id="0" name="Compare tile at" sid="1132534139385217" type="Maps">
                                                                    <param id="0" name="Tile X">int(Wagon.xPos-Wagon.xDirection/2)</param>
                                                                    <param id="1" name="Tile Y">int(Wagon.yPos)</param>
                                                                    <param id="2" name="Comparison">0</param>
                                                                    <param id="3" name="Tile">TILE_TRACK</param>
                                                                </condition>
                                                            </conditions>
                                                            <actions>
                                                                <action id="-9" name="Set value" sid="3240514013854912" type="System">
                                                                    <param id="0" name="Variable">velocity</param>
                                                                    <param id="1" name="Value">velocity*TRACKBONUS</param>
                                                                </action>
                                                            </actions>
                                                        </event-block>
                                                    </sub-events>
                                                </event-block>
                                                <comment>FInally move the cart driven by the velocity etc.</comment>
                                                <event-block sid="1484727417018761">
                                                    <conditions>
                                                        <condition id="-1" name="Every tick" sid="6047150353472641" type="System" />
                                                    </conditions>
                                                    <actions>
                                                        <action id="-10" name="Set value" sid="3552674561994766" type="Wagon">
                                                            <param id="0" name="Instance variable">xPos</param>
                                                            <param id="1" name="Value">min(abs(Wagon.xPos-Wagon.xTarget),velocity*dt) * ((Wagon.xPos &lt; Wagon.xTarget) ? 1 : -1) + Wagon.xPos</param>
                                                        </action>
                                                        <action id="-10" name="Set value" sid="6699842841575516" type="Wagon">
                                                            <param id="0" name="Instance variable">yPos</param>
                                                            <param id="1" name="Value">min(abs(Wagon.yPos-Wagon.yTarget),velocity*dt) * ((Wagon.yPos &lt; Wagon.yTarget) ? 1 : -1) + Wagon.yPos</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-group description="Decides what to do" sid="7839480245332561" title="Examine State" />
                                <event-block sid="3244837472881876">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="702678904731347" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_EXAMINE</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-10" name="Set value" sid="1487886069587986" type="Wagon">
                                            <param id="0" name="Instance variable">waitTime</param>
                                            <param id="1" name="Value">Function.Call(&quot;WagonCheck&quot; &amp; Wagon.name,Wagon.UID)</param>
                                        </action>
                                    </actions>
                                    <sub-events>
                                        <comment>Failed to do whatever it is we are doing.</comment>
                                        <event-block sid="50384397974999">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="2751766919009441" type="Wagon">
                                                    <param id="0" name="Instance variable">waitTime</param>
                                                    <param id="1" name="Comparison">2</param>
                                                    <param id="2" name="Value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-10" name="Set value" sid="8454489587970767" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Value">WST_DONE</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <comment>Done it, add the current time to the wait time to give a time to end waiting, and switch to waiting</comment>
                                        <event-block sid="4561450839705015">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="7690381366735366" type="Wagon">
                                                    <param id="0" name="Instance variable">waitTime</param>
                                                    <param id="1" name="Comparison">5</param>
                                                    <param id="2" name="Value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-10" name="Set value" sid="8543543613743488" type="Wagon">
                                                    <param id="0" name="Instance variable">waitTime</param>
                                                    <param id="1" name="Value">Wagon.waitTime+time</param>
                                                </action>
                                                <action id="-10" name="Set value" sid="1779858419444925" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Value">WST_WAIT</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-group description="Waiting for processing" sid="3604640062521944" title="Wait State" />
                                <event-block sid="795076228938176">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="3325185680762444" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_WAIT</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>When wait over, switch to execute</comment>
                                        <event-block sid="6783194442526278">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="2278171563401002" type="Wagon">
                                                    <param id="0" name="Instance variable">waitTime</param>
                                                    <param id="1" name="Comparison">2</param>
                                                    <param id="2" name="Value">time</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-10" name="Set value" sid="9650261972430994" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Value">WST_EXECUTE</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-group description="Do the actual action" sid="878928637020283" title="Execute State" />
                                <event-block sid="3152894791384424">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="1556690868316774" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_EXECUTE</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-10" name="Set value" sid="5549815660728572" type="Wagon">
                                            <param id="0" name="Instance variable">state</param>
                                            <param id="1" name="Value">WST_MOVE</param>
                                        </action>
                                    </actions>
                                    <sub-events>
                                        <comment>Do the execution, and adjust x or y depending on return value</comment>
                                        <event-block sid="2386871749793255">
                                            <conditions>
                                                <condition id="-8" name="Compare two values" sid="3895873983310507" type="System">
                                                    <param id="0" name="First value">Function.Call(&quot;WagonExecute&quot; &amp; Wagon.name,Wagon.UID)</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Second value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-11" name="Add to" sid="557978308303726" type="Wagon">
                                                    <param id="0" name="Instance variable">xTarget</param>
                                                    <param id="1" name="Value">Wagon.xDirection</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <event-block sid="4113100515514388">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="1773603279830578" type="System" />
                                            </conditions>
                                            <actions>
                                                <action id="-11" name="Add to" sid="9662527571667265" type="Wagon">
                                                    <param id="0" name="Instance variable">yTarget</param>
                                                    <param id="1" name="Value">1</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <comment>If actionMaxCount is non zero, the number of actions is limited</comment>
                                        <event-block sid="221651819755897">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="2528359881130946" type="Wagon">
                                                    <param id="0" name="Instance variable">actionMaxCount</param>
                                                    <param id="1" name="Comparison">4</param>
                                                    <param id="2" name="Value">0</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-12" name="Subtract from" sid="4301453296706479" type="Wagon">
                                                    <param id="0" name="Instance variable">actionMaxCount</param>
                                                    <param id="1" name="Value">1</param>
                                                </action>
                                            </actions>
                                            <sub-events>
                                                <comment>Done them all, so go to done state</comment>
                                                <event-block sid="7072472162737857">
                                                    <conditions>
                                                        <condition id="-7" name="Compare instance variable" sid="2092180461872777" type="Wagon">
                                                            <param id="0" name="Instance variable">actionMaxCount</param>
                                                            <param id="1" name="Comparison">0</param>
                                                            <param id="2" name="Value">0</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="-10" name="Set value" sid="5244359602987491" type="Wagon">
                                                            <param id="0" name="Instance variable">state</param>
                                                            <param id="1" name="Value">WST_DONE</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-group description="Move to next square " sid="8881802803315421" title="Move state" />
                                <event-block sid="7684114523250413">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="9368140496903037" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_MOVE</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <variable constant="0" name="velocity" sid="6429687875943865" static="0" type="number">1</variable>
                                        <comment>Reached target, open view and go back to see if we can do the action again</comment>
                                        <event-block sid="1698454241375083">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="9078647528484165" type="Wagon">
                                                    <param id="0" name="Instance variable">xPos</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">Wagon.xTarget</param>
                                                </condition>
                                                <condition id="-7" name="Compare instance variable" sid="2657812043694916" type="Wagon">
                                                    <param id="0" name="Instance variable">yPos</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">Wagon.yTarget</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-10" name="Set value" sid="6872028493827721" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Value">WST_EXAMINE</param>
                                                </action>
                                                <action id="0" name="Call function" sid="3848606814604555" type="Function">
                                                    <param id="0" name="Name">&quot;OpenView&quot;</param>
                                                    <param id="1" name="Parameter {n}">Visibility.UID{###}Wagon.xPos{###}Wagon.yPos{###}Wagon.viewDistance</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <comment>Othewise move towards target position</comment>
                                        <event-block sid="7143040119363081">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="7260993914727036" type="System" />
                                            </conditions>
                                            <actions>
                                                <action id="-9" name="Set value" sid="3406977255778347" type="System">
                                                    <param id="0" name="Variable">velocity</param>
                                                    <param id="1" name="Value">ADVANCESPEED</param>
                                                </action>
                                                <action id="-10" name="Set value" sid="6672900778500053" type="Wagon">
                                                    <param id="0" name="Instance variable">xPos</param>
                                                    <param id="1" name="Value">min(abs(Wagon.xPos-Wagon.xTarget),velocity*dt) * ((Wagon.xPos &lt; Wagon.xTarget) ? 1 : -1) + Wagon.xPos</param>
                                                </action>
                                                <action id="-10" name="Set value" sid="7999416327063847" type="Wagon">
                                                    <param id="0" name="Instance variable">yPos</param>
                                                    <param id="1" name="Value">min(abs(Wagon.yPos-Wagon.yTarget),velocity*dt) * ((Wagon.yPos &lt; Wagon.yTarget) ? 1 : -1) + Wagon.yPos</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <event-group description="Goes here when done - decide whether to destroy the wagon (one shots) or return it" sid="280447223438237" title="Done state" />
                                <event-block sid="6107901904918612">
                                    <conditions>
                                        <condition id="-14" name="Compare variable" sid="9996015206752452" type="System">
                                            <param id="0" name="Variable">state</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Value">WST_DONE</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <comment>One shot - destroy the wagon and the marker</comment>
                                        <event-block sid="4478068564451142">
                                            <conditions>
                                                <condition id="-8" name="Is boolean instance variable set" sid="6843506687776068" type="Wagon">
                                                    <param id="0" name="Instance variable">isOneShot</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-10" name="Set value" sid="1467004301370345" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Value">WST_DESTROYED</param>
                                                </action>
                                                <action behavior="DestroyFade" id="1" name="Start fade" sid="2865958887585273" type="Wagon" />
                                            </actions>
                                            <sub-events>
                                                <event-block sid="1302415079068497">
                                                    <conditions>
                                                        <condition id="-14" name="Pick by unique ID" sid="9136339603430703" type="WagonMarker">
                                                            <param id="0" name="Unique ID">Wagon.markerUID</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="-9" name="Destroy" sid="337872806287268" type="WagonMarker" />
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                        <comment>Not one shot, return the wagon.</comment>
                                        <event-block sid="9836463525995619">
                                            <conditions>
                                                <condition id="-22" name="Else" sid="2480991085728982" type="System" />
                                            </conditions>
                                            <actions>
                                                <action id="0" name="Call function" sid="7115607219289786" type="Function">
                                                    <param id="0" name="Name">&quot;WagonReturn&quot;</param>
                                                    <param id="1" name="Parameter {n}">Wagon.UID</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                                <comment>And if it isn&apos;t queued, update the position. If it is, we let the queuer handle visibility and so on.</comment>
                                <event-block sid="3622334310255611">
                                    <conditions>
                                        <condition id="-7" name="Compare instance variable" sid="4582395082970476" type="Wagon">
                                            <param id="0" name="Instance variable">state</param>
                                            <param id="1" name="Comparison">1</param>
                                            <param id="2" name="Value">WST_QUEUED</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-3" name="Set position" sid="4917885658275123" type="Wagon">
                                            <param id="0" name="X">Wagon.xPos*MAPTILESIZE+Map.X</param>
                                            <param id="1" name="Y">Wagon.yPos*MAPTILESIZE+Map.Y</param>
                                        </action>
                                    </actions>
                                    <sub-events>
                                        <comment>Then update its marker in the scanner</comment>
                                        <event-block sid="2962335235083702">
                                            <conditions>
                                                <condition id="-14" name="Pick by unique ID" sid="8200846880689446" type="WagonMarker">
                                                    <param id="0" name="Unique ID">Wagon.markerUID</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-3" name="Set position" sid="3557177510300962" type="WagonMarker">
                                                    <param id="0" name="X">Scanner.X+SCANNEREDGE+Wagon.xPos/MAPWIDTH*SCANNERSIZE</param>
                                                    <param id="1" name="Y">Scanner.Y+SCANNEREDGE+Wagon.yPos/MAPHEIGHT*SCANNERSIZE</param>
                                                </action>
                                                <action id="-15" name="Set visible" sid="8251991732449305" type="WagonMarker">
                                                    <param id="0" name="Visibility">1</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                        <event-block sid="9020065345445667">
                                            <conditions>
                                                <condition id="-7" name="Compare instance variable" sid="966690551925706" type="Wagon">
                                                    <param id="0" name="Instance variable">state</param>
                                                    <param id="1" name="Comparison">0</param>
                                                    <param id="2" name="Value">WST_WAIT</param>
                                                </condition>
                                            </conditions>
                                            <actions>
                                                <action id="-1" name="Set X" sid="4722868630578089" type="Wagon">
                                                    <param id="0" name="X">Wagon.X + sin(time * 2500) *2</param>
                                                </action>
                                            </actions>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <comment></comment>
        <event-group description="Parameters (UID, x Target, yTarget). " sid="2054259162758044" title="Start Wagon">
            <sub-events>
                <event-block sid="1751844255018568">
                    <conditions>
                        <condition id="0" name="On function" sid="2839185408981511" type="Function">
                            <param id="0" name="Name">&quot;WagonStart&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="9912186354960574">
                            <conditions>
                                <condition id="-14" name="Pick by unique ID" sid="7981198724346136" type="Wagon">
                                    <param id="0" name="Unique ID">Function.Param(0)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-10" name="Set value" sid="2151839390365109" type="Wagon">
                                    <param id="0" name="Instance variable">xPos</param>
                                    <param id="1" name="Value">(Function.Param(1) &gt; MAPXSHAFT) ? MAPXSHAFT+1 : MAPXSHAFT</param>
                                </action>
                                <action id="-10" name="Set value" sid="737362724651352" type="Wagon">
                                    <param id="0" name="Instance variable">yPos</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-10" name="Set value" sid="9396662343680669" type="Wagon">
                                    <param id="0" name="Instance variable">xDirection</param>
                                    <param id="1" name="Value">(Function.Param(1) &gt; MAPXSHAFT) ? 1 : -1</param>
                                </action>
                                <action id="-10" name="Set value" sid="1808023895467632" type="Wagon">
                                    <param id="0" name="Instance variable">xTarget</param>
                                    <param id="1" name="Value">Wagon.xPos</param>
                                </action>
                                <action id="-10" name="Set value" sid="7222739868598039" type="Wagon">
                                    <param id="0" name="Instance variable">yTarget</param>
                                    <param id="1" name="Value">Wagon.yPos</param>
                                </action>
                                <action id="-15" name="Set visible" sid="4429848485616141" type="Wagon">
                                    <param id="0" name="Visibility">1</param>
                                </action>
                                <action id="-10" name="Set value" sid="1996506746969976" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Value">WST_OUTBOUND</param>
                                </action>
                                <action id="-10" name="Set value" sid="5589907413248513" type="Wagon">
                                    <param id="0" name="Instance variable">routeList</param>
                                    <param id="1" name="Value">Function.Call(&quot;GetRouteDown&quot;,Map.UID,Function.Param(1),Function.Param(2))</param>
                                </action>
                                <action id="-10" name="Set value" sid="4731143549042704" type="Wagon">
                                    <param id="0" name="Instance variable">coalCount</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-10" name="Set value" sid="1883239244450071" type="Wagon">
                                    <param id="0" name="Instance variable">diamondCount</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-10" name="Set value" sid="1035679718864239" type="Wagon">
                                    <param id="0" name="Instance variable">silverCount</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-10" name="Set value" sid="2693339971986275" type="Wagon">
                                    <param id="0" name="Instance variable">goldCount</param>
                                    <param id="1" name="Value">0</param>
                                </action>
                                <action id="-26" name="Move to layer" sid="8080108062716754" type="Wagon">
                                    <param id="0" name="Layer">2</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <comment></comment>
        <event-group description="Parameter UID" sid="1404670469753592" title="Return Wagon to top">
            <sub-events>
                <event-block sid="5084543619383919">
                    <conditions>
                        <condition id="0" name="On function" sid="1572367992684249" type="Function">
                            <param id="0" name="Name">&quot;WagonReturn&quot;</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <event-block sid="6928134731900991">
                            <conditions>
                                <condition id="-14" name="Pick by unique ID" sid="9711849852556756" type="Wagon">
                                    <param id="0" name="Unique ID">Function.Param(0)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-10" name="Set value" sid="8384099243676778" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Value">WST_RETURN</param>
                                </action>
                                <action id="-10" name="Set value" sid="759221312892828" type="Wagon">
                                    <param id="0" name="Instance variable">routeList</param>
                                    <param id="1" name="Value">Function.Call(&quot;GetRouteHome&quot;,Map.UID,Wagon.xPos,Wagon.yPos)</param>
                                </action>
                                <action id="-10" name="Set value" sid="8427351222245398" type="Wagon">
                                    <param id="0" name="Instance variable">xTarget</param>
                                    <param id="1" name="Value">Wagon.xPos</param>
                                </action>
                                <action id="-10" name="Set value" sid="8206922743942528" type="Wagon">
                                    <param id="0" name="Instance variable">yTarget</param>
                                    <param id="1" name="Value">Wagon.yPos</param>
                                </action>
                                <action id="0" name="Play" sid="4825708276909343" type="Audio">
                                    <param id="0" name="Audio file">return</param>
                                    <param id="2" name="Loop">0</param>
                                    <param id="3" name="Volume">0</param>
                                    <param id="1" name="Tag (optional)">&quot;&quot;</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-group>
        <event-group description="Parameter UID" sid="6971175659246037" title="Handle click on wagon" />
        <comment>Clicking on wagon returns in some states</comment>
        <event-block sid="3095290396226369">
            <conditions>
                <condition id="0" name="On function" sid="4431927880818149" type="Function">
                    <param id="0" name="Name">&quot;WagonClicked&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="990286185213673">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="7660200044276911" type="Wagon">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                    </conditions>
                    <actions />
                    <sub-events>
                        <comment>Once started to operate, go to done state as may be one shot</comment>
                        <event-block any="1" sid="1061775460672907">
                            <conditions>
                                <condition id="-7" name="Compare instance variable" sid="5095388721238406" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">WST_EXAMINE</param>
                                </condition>
                                <condition id="-7" name="Compare instance variable" sid="7609462937012253" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">WST_WAIT</param>
                                </condition>
                                <condition id="-7" name="Compare instance variable" sid="7573113215334354" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">WST_EXECUTE</param>
                                </condition>
                                <condition id="-7" name="Compare instance variable" sid="3100478215803344" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">WST_MOVE</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-10" name="Set value" sid="2348022432224359" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Value">WST_DONE</param>
                                </action>
                            </actions>
                        </event-block>
                        <comment>On outbound trip can always return.</comment>
                        <event-block sid="242052636783563">
                            <conditions>
                                <condition id="-7" name="Compare instance variable" sid="1098723345205425" type="Wagon">
                                    <param id="0" name="Instance variable">state</param>
                                    <param id="1" name="Comparison">0</param>
                                    <param id="2" name="Value">WST_OUTBOUND</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="0" name="Call function" sid="462918679976662" type="Function">
                                    <param id="0" name="Name">&quot;WagonReturn&quot;</param>
                                    <param id="1" name="Parameter {n}">Wagon.UID</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-block>
        <event-group description="These are for testing only" sid="1205912135634202" title="Demo Wagon Handlers" />
        <event-block sid="7748018364019297">
            <conditions>
                <condition id="0" name="On function" sid="2514950991955981" type="Function">
                    <param id="0" name="Name">&quot;WagonCheckDemo&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="6198096248442833">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="4466049966057656" type="Wagon">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Set return value" sid="5099767790766967" type="Function">
                            <param id="0" name="Value">2</param>
                        </action>
                    </actions>
                    <sub-events>
                        <event-block sid="6105233016715087">
                            <conditions>
                                <condition id="0" name="Compare tile at" sid="7728231254562951" type="Maps">
                                    <param id="0" name="Tile X">Wagon.xPos+Wagon.xDirection</param>
                                    <param id="1" name="Tile Y">Wagon.yPos</param>
                                    <param id="2" name="Comparison">0</param>
                                    <param id="3" name="Tile">TILE_GRANITE</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="1" name="Set return value" sid="9788455829445169" type="Function">
                                    <param id="0" name="Value">-1</param>
                                </action>
                            </actions>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-block>
        <event-block sid="9991835358961472">
            <conditions>
                <condition id="0" name="On function" sid="2213283801962163" type="Function">
                    <param id="0" name="Name">&quot;WagonExecuteDemo&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="1" name="Set return value" sid="9600558935905996" type="Function">
                    <param id="0" name="Value">0</param>
                </action>
            </actions>
            <sub-events>
                <event-block sid="8583688356518918">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="1067959540697657" type="Wagon">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="1" name="Set tile" sid="3862973985460358" type="Maps">
                            <param id="0" name="Tile X">Wagon.xPos+Wagon.xDirection</param>
                            <param id="1" name="Tile Y">Wagon.yPos</param>
                            <param id="2" name="Tile">TILE_TRACK</param>
                            <param id="3" name="State">0</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
    </events>
</c2eventsheet>
