<?xml version="1.0" encoding="utf-8" ?>
<c2eventsheet>
    <!--All the 'name' attributes are ignored by Construct 2 - they are there for readability only.-->
    <name>Map Creation</name>
    <events>
        <event-group description="Creates a map using the Map object passed by UID" sid="7624643688828855" title="Map Creation Code" />
        <event-block sid="3513011927762901">
            <conditions>
                <condition id="0" name="On function" sid="5542377744148332" type="Function">
                    <param id="0" name="Name">&quot;SetupMap&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="4262698611899847">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="3481217957764961" type="Covers">
                            <param id="0" name="Unique ID">Function.Param(1)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="3" name="Set tile range" sid="9964896577449958" type="Covers">
                            <param id="0" name="Tile X">0</param>
                            <param id="1" name="Tile Y">0</param>
                            <param id="2" name="Width">MAPWIDTH</param>
                            <param id="3" name="Height">MAPHEIGHT</param>
                            <param id="4" name="Tile">TILEV_CLOSED</param>
                            <param id="5" name="State">0</param>
                        </action>
                    </actions>
                </event-block>
                <variable constant="0" name="n" sid="8261882031328767" static="0" type="number">0</variable>
                <variable constant="0" name="x" sid="4348090872211142" static="0" type="number">0</variable>
                <variable constant="0" name="y" sid="6836602967910831" static="0" type="number">0</variable>
                <comment>First, fill the area with earth.</comment>
                <event-block sid="5567828644233115">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="7618434222956278" type="Map">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="3" name="Set tile range" sid="7639196963497589" type="Map">
                            <param id="0" name="Tile X">0</param>
                            <param id="1" name="Tile Y">0</param>
                            <param id="2" name="Width">MAPWIDTH</param>
                            <param id="3" name="Height">MAPHEIGHT</param>
                            <param id="4" name="Tile">TILE_EARTH</param>
                            <param id="5" name="State">0</param>
                        </action>
                    </actions>
                    <sub-events>
                        <comment>Create coal</comment>
                        <event-block sid="9746516948517504">
                            <conditions>
                                <condition id="-10" name="For" sid="5383242531412147" type="System">
                                    <param id="0" name="Name">&quot;&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">round(MAPAREA*PC_COAL/100)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="5979438190581695" type="System">
                                    <param id="0" name="Variable">x</param>
                                    <param id="1" name="Value">floor(random(0,MAPWIDTH))</param>
                                </action>
                                <action id="-9" name="Set value" sid="9784294106079005" type="System">
                                    <param id="0" name="Variable">y</param>
                                    <param id="1" name="Value">Function.Call(&quot;PowerScale&quot;,0.8)</param>
                                </action>
                                <action id="-9" name="Set value" sid="3836782190239689" type="System">
                                    <param id="0" name="Variable">n</param>
                                    <param id="1" name="Value">floor(random(1,3))</param>
                                </action>
                            </actions>
                            <sub-events>
                                <event-block sid="3649919554326105">
                                    <conditions>
                                        <condition id="-10" name="For" sid="8814401934286047" type="System">
                                            <param id="0" name="Name">&quot;xi&quot;</param>
                                            <param id="1" name="Start index">-n-1</param>
                                            <param id="2" name="End index">n+1</param>
                                        </condition>
                                    </conditions>
                                    <actions />
                                    <sub-events>
                                        <event-block sid="9372657370280245">
                                            <conditions>
                                                <condition id="-10" name="For" sid="8535629877779334" type="System">
                                                    <param id="0" name="Name">&quot;yi&quot;</param>
                                                    <param id="1" name="Start index">-n</param>
                                                    <param id="2" name="End index">n</param>
                                                </condition>
                                            </conditions>
                                            <actions />
                                            <sub-events>
                                                <event-block sid="7085822137341605">
                                                    <conditions>
                                                        <condition id="-8" name="Compare two values" sid="2021157221106027" type="System">
                                                            <param id="0" name="First value">random(1)</param>
                                                            <param id="1" name="Comparison">2</param>
                                                            <param id="2" name="Second value">0.4</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="1" name="Set tile" sid="7233332018801284" type="Map">
                                                            <param id="0" name="Tile X">loopindex(&quot;xi&quot;)+x</param>
                                                            <param id="1" name="Tile Y">loopindex(&quot;yi&quot;)+y</param>
                                                            <param id="2" name="Tile">TILE_EARTH+floor(random(1,15))</param>
                                                            <param id="3" name="State">0</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>Create silver and gold</comment>
                        <event-block sid="2164281489883362">
                            <conditions>
                                <condition id="-10" name="For" sid="6702580343536371" type="System">
                                    <param id="0" name="Name">&quot;type&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">2</param>
                                </condition>
                            </conditions>
                            <actions />
                            <sub-events>
                                <event-block sid="409237766728141">
                                    <conditions>
                                        <condition id="-10" name="For" sid="9892875451478299" type="System">
                                            <param id="0" name="Name">&quot;&quot;</param>
                                            <param id="1" name="Start index">1</param>
                                            <param id="2" name="End index">round(MAPAREA*((loopindex(&quot;type&quot;) = 1) ? PC_SILVER:PC_GOLD)/100)</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-9" name="Set value" sid="8684609408775706" type="System">
                                            <param id="0" name="Variable">x</param>
                                            <param id="1" name="Value">floor(random(0,MAPWIDTH))</param>
                                        </action>
                                        <action id="-9" name="Set value" sid="4055132835289918" type="System">
                                            <param id="0" name="Variable">y</param>
                                            <param id="1" name="Value">Function.Call(&quot;PowerScale&quot;,(loopindex(&quot;type&quot;)=1) ? 0.5:0.4)</param>
                                        </action>
                                    </actions>
                                    <sub-events>
                                        <event-block sid="9269039518798232">
                                            <conditions>
                                                <condition id="-10" name="For" sid="6621429917745865" type="System">
                                                    <param id="0" name="Name">&quot;&quot;</param>
                                                    <param id="1" name="Start index">1</param>
                                                    <param id="2" name="End index">floor(random(3,5))</param>
                                                </condition>
                                            </conditions>
                                            <actions />
                                            <sub-events>
                                                <event-block sid="3878626702228493">
                                                    <conditions>
                                                        <condition id="-8" name="Compare two values" sid="1727592337610101" type="System">
                                                            <param id="0" name="First value">random(1)</param>
                                                            <param id="1" name="Comparison">2</param>
                                                            <param id="2" name="Second value">0.7</param>
                                                        </condition>
                                                    </conditions>
                                                    <actions>
                                                        <action id="1" name="Set tile" sid="3237514994306845" type="Map">
                                                            <param id="0" name="Tile X">x</param>
                                                            <param id="1" name="Tile Y">y</param>
                                                            <param id="2" name="Tile">(loopindex(&quot;type&quot;) = 1) ? TILE_SILVER : TILE_GOLD</param>
                                                            <param id="3" name="State">0</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                                <event-block sid="1612483881922257">
                                                    <conditions>
                                                        <condition id="-1" name="Every tick" sid="6117854974363431" type="System" />
                                                    </conditions>
                                                    <actions>
                                                        <action id="-10" name="Add to" sid="2532166118291076" type="System">
                                                            <param id="0" name="Variable">x</param>
                                                            <param id="1" name="Value">1</param>
                                                        </action>
                                                    </actions>
                                                </event-block>
                                            </sub-events>
                                        </event-block>
                                    </sub-events>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>Create bars of rock</comment>
                        <event-block sid="7018502617253899">
                            <conditions>
                                <condition id="-10" name="For" sid="7678947065767217" type="System">
                                    <param id="0" name="Name">&quot;&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">round(MAPAREA*PC_ROCKBAR/100)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="-9" name="Set value" sid="1525707236084863" type="System">
                                    <param id="0" name="Variable">y</param>
                                    <param id="1" name="Value">Function.Call(&quot;PowerScale&quot;,0.6)</param>
                                </action>
                            </actions>
                            <sub-events>
                                <event-block sid="5889964657810869">
                                    <conditions>
                                        <condition id="-8" name="Compare two values" sid="571404454331516" type="System">
                                            <param id="0" name="First value">choose(1,2)</param>
                                            <param id="1" name="Comparison">0</param>
                                            <param id="2" name="Second value">1</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="-9" name="Set value" sid="1109596270732988" type="System">
                                            <param id="0" name="Variable">n</param>
                                            <param id="1" name="Value">floor(random(2,8))</param>
                                        </action>
                                        <action id="3" name="Set tile range" sid="4207699430284322" type="Map">
                                            <param id="0" name="Tile X">floor(random(0,MAPHEIGHT)-n/2)</param>
                                            <param id="1" name="Tile Y">y</param>
                                            <param id="2" name="Width">n</param>
                                            <param id="3" name="Height">1</param>
                                            <param id="4" name="Tile">TILE_ROCK</param>
                                            <param id="5" name="State">0</param>
                                        </action>
                                    </actions>
                                </event-block>
                                <event-block sid="2785906381646091">
                                    <conditions>
                                        <condition id="-22" name="Else" sid="1700584002353369" type="System" />
                                    </conditions>
                                    <actions>
                                        <action id="-9" name="Set value" sid="8700693514994691" type="System">
                                            <param id="0" name="Variable">n</param>
                                            <param id="1" name="Value">floor(random(2,3))</param>
                                        </action>
                                        <action id="3" name="Set tile range" sid="9477022508312164" type="Map">
                                            <param id="0" name="Tile X">floor(random(0,MAPHEIGHT))</param>
                                            <param id="1" name="Tile Y">floor(y-n/2)</param>
                                            <param id="2" name="Width">1</param>
                                            <param id="3" name="Height">n</param>
                                            <param id="4" name="Tile">TILE_ROCK</param>
                                            <param id="5" name="State">0</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                        <comment>Create singletons of rock</comment>
                        <event-block sid="5825056391781169">
                            <conditions>
                                <condition id="-10" name="For" sid="5833774119414607" type="System">
                                    <param id="0" name="Name">&quot;&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">round(MAPAREA*PC_ROCKALONE/100)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="1" name="Set tile" sid="820726514785144" type="Map">
                                    <param id="0" name="Tile X">floor(random(0,MAPWIDTH))</param>
                                    <param id="1" name="Tile Y">Function.Call(&quot;PowerScale&quot;,0.6)</param>
                                    <param id="2" name="Tile">TILE_ROCK</param>
                                    <param id="3" name="State">0</param>
                                </action>
                            </actions>
                        </event-block>
                        <comment>Create diamonds</comment>
                        <event-block sid="4440400011950921">
                            <conditions>
                                <condition id="-10" name="For" sid="3032882620506342" type="System">
                                    <param id="0" name="Name">&quot;&quot;</param>
                                    <param id="1" name="Start index">1</param>
                                    <param id="2" name="End index">round(MAPAREA*PC_DIAMOND/100)</param>
                                </condition>
                            </conditions>
                            <actions>
                                <action id="1" name="Set tile" sid="4483236525714095" type="Map">
                                    <param id="0" name="Tile X">floor(random(0,MAPWIDTH))</param>
                                    <param id="1" name="Tile Y">Function.Call(&quot;PowerScale&quot;,0.3)</param>
                                    <param id="2" name="Tile">TILE_DIAMOND</param>
                                    <param id="3" name="State">0</param>
                                </action>
                            </actions>
                        </event-block>
                        <comment>Create frame and initial shaft.</comment>
                        <event-block sid="8660353035851484">
                            <conditions>
                                <condition id="-1" name="Every tick" sid="1002863278679653" type="System" />
                            </conditions>
                            <actions>
                                <action id="3" name="Set tile range" sid="2646438173666301" type="Map">
                                    <param id="0" name="Tile X">0</param>
                                    <param id="1" name="Tile Y">0</param>
                                    <param id="2" name="Width">1</param>
                                    <param id="3" name="Height">MAPHEIGHT</param>
                                    <param id="4" name="Tile">TILE_GRANITE</param>
                                    <param id="5" name="State">0</param>
                                </action>
                                <action id="3" name="Set tile range" sid="6141010777397472" type="Map">
                                    <param id="0" name="Tile X">MAPWIDTH-1</param>
                                    <param id="1" name="Tile Y">0</param>
                                    <param id="2" name="Width">1</param>
                                    <param id="3" name="Height">MAPHEIGHT</param>
                                    <param id="4" name="Tile">TILE_GRANITE</param>
                                    <param id="5" name="State">0</param>
                                </action>
                                <action id="3" name="Set tile range" sid="837071455104093" type="Map">
                                    <param id="0" name="Tile X">0</param>
                                    <param id="1" name="Tile Y">MAPHEIGHT-1</param>
                                    <param id="2" name="Width">MAPWIDTH</param>
                                    <param id="3" name="Height">1</param>
                                    <param id="4" name="Tile">TILE_GRANITE</param>
                                    <param id="5" name="State">0</param>
                                </action>
                                <action id="3" name="Set tile range" sid="8672687574156765" type="Map">
                                    <param id="0" name="Tile X">0</param>
                                    <param id="1" name="Tile Y">0</param>
                                    <param id="2" name="Width">MAPWIDTH</param>
                                    <param id="3" name="Height">1</param>
                                    <param id="4" name="Tile">TILE_TOP</param>
                                    <param id="5" name="State">0</param>
                                </action>
                                <action id="3" name="Set tile range" sid="3554271693870016" type="Map">
                                    <param id="0" name="Tile X">MAPXSHAFT</param>
                                    <param id="1" name="Tile Y">0</param>
                                    <param id="2" name="Width">1</param>
                                    <param id="3" name="Height">MAPSHAFTDEPTH</param>
                                    <param id="4" name="Tile">TILE_SHAFT</param>
                                    <param id="5" name="State">0</param>
                                </action>
                            </actions>
                            <sub-events>
                                <comment>Open up visibility around the shaft</comment>
                                <event-block sid="5480383293777392">
                                    <conditions>
                                        <condition id="-10" name="For" sid="6401009564942643" type="System">
                                            <param id="0" name="Name">&quot;&quot;</param>
                                            <param id="1" name="Start index">0</param>
                                            <param id="2" name="End index">MAPSHAFTDEPTH-1</param>
                                        </condition>
                                    </conditions>
                                    <actions>
                                        <action id="0" name="Call function" sid="7267394750079749" type="Function">
                                            <param id="0" name="Name">&quot;OpenView&quot;</param>
                                            <param id="1" name="Parameter {n}">Function.Param(1){###}MAPXSHAFT{###}loopindex{###}3</param>
                                        </action>
                                    </actions>
                                </event-block>
                            </sub-events>
                        </event-block>
                    </sub-events>
                </event-block>
            </sub-events>
        </event-block>
        <comment>Function generates a vertical position whcich uses a parameter to push it down - the parameter is 0-1, the lower it is the more likely it is to be at the bottom of the range (e.g. higher)</comment>
        <event-block sid="5530068894176318">
            <conditions>
                <condition id="0" name="On function" sid="1409278186562534" type="Function">
                    <param id="0" name="Name">&quot;PowerScale&quot;</param>
                </condition>
            </conditions>
            <actions>
                <action id="1" name="Set return value" sid="1783024603078014" type="Function">
                    <param id="0" name="Value">floor((random(1)^Function.Param(0))*MAPHEIGHT)</param>
                </action>
            </actions>
        </event-block>
        <event-group description="Create a test map" sid="3050826925453861" title="Test Map" />
        <comment>Create the demo map</comment>
        <event-block sid="2638843136437325">
            <conditions>
                <condition id="0" name="On function" sid="1414995438948979" type="Function">
                    <param id="0" name="Name">&quot;OpenDemoMap&quot;</param>
                </condition>
            </conditions>
            <actions />
            <sub-events>
                <event-block sid="1358800576692091">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="4652668249170378" type="Map">
                            <param id="0" name="Unique ID">Function.Param(0)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="3" name="Set tile range" sid="1635615334807132" type="Map">
                            <param id="0" name="Tile X">6</param>
                            <param id="1" name="Tile Y">4</param>
                            <param id="2" name="Width">14</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="1841121238233438" type="Map">
                            <param id="0" name="Tile X">11</param>
                            <param id="1" name="Tile Y">10</param>
                            <param id="2" name="Width">9</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="6646795714828577" type="Map">
                            <param id="0" name="Tile X">21</param>
                            <param id="1" name="Tile Y">8</param>
                            <param id="2" name="Width">11</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="6432967628676743" type="Map">
                            <param id="0" name="Tile X">21</param>
                            <param id="1" name="Tile Y">11</param>
                            <param id="2" name="Width">7</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="7167122265355433" type="Map">
                            <param id="0" name="Tile X">2</param>
                            <param id="1" name="Tile Y">14</param>
                            <param id="2" name="Width">5</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="7684977234895146" type="Map">
                            <param id="0" name="Tile X">26</param>
                            <param id="1" name="Tile Y">22</param>
                            <param id="2" name="Width">9</param>
                            <param id="3" name="Height">1</param>
                            <param id="4" name="Tile">TILE_OPEN</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="2954729073625868" type="Map">
                            <param id="0" name="Tile X">26</param>
                            <param id="1" name="Tile Y">12</param>
                            <param id="2" name="Width">1</param>
                            <param id="3" name="Height">11</param>
                            <param id="4" name="Tile">TILE_SHAFT</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="7990562992867673" type="Map">
                            <param id="0" name="Tile X">24</param>
                            <param id="1" name="Tile Y">9</param>
                            <param id="2" name="Width">1</param>
                            <param id="3" name="Height">7</param>
                            <param id="4" name="Tile">TILE_SHAFT</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="8104876375305682" type="Map">
                            <param id="0" name="Tile X">14</param>
                            <param id="1" name="Tile Y">11</param>
                            <param id="2" name="Width">1</param>
                            <param id="3" name="Height">9</param>
                            <param id="4" name="Tile">TILE_SHAFT</param>
                            <param id="5" name="State">0</param>
                        </action>
                        <action id="3" name="Set tile range" sid="6359312655937705" type="Map">
                            <param id="0" name="Tile X">7</param>
                            <param id="1" name="Tile Y">5</param>
                            <param id="2" name="Width">1</param>
                            <param id="3" name="Height">10</param>
                            <param id="4" name="Tile">TILE_SHAFT</param>
                            <param id="5" name="State">0</param>
                        </action>
                    </actions>
                </event-block>
                <comment>On the demo, make the cover opaque enough so you can see it and the map underneath</comment>
                <event-block sid="8914121834329249">
                    <conditions>
                        <condition id="-14" name="Pick by unique ID" sid="222718723118264" type="Covers">
                            <param id="0" name="Unique ID">Function.Param(1)</param>
                        </condition>
                    </conditions>
                    <actions>
                        <action id="-16" name="Set opacity" sid="9835168224759223" type="Covers">
                            <param id="0" name="Opacity">44</param>
                        </action>
                    </actions>
                </event-block>
            </sub-events>
        </event-block>
    </events>
</c2eventsheet>
